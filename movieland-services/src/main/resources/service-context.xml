<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:task="http://www.springframework.org/schema/task"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd">

    <!--<bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">-->
        <!--<property name="locations" value="classpath:properties/application-service.properties" order = 2/>-->
    <!--</bean>-->

    <context:property-placeholder location="classpath*:properties/application-service.properties" ignore-unresolvable="true" order="1" />


    <import resource="classpath:/persistence-context.xml"/>

    <context:component-scan base-package="com.dsliusar.services"/>
    <context:annotation-config />
    <task:annotation-driven />
    <task:scheduler id="myScheduler"/>

    <bean id="genreCacheUpdateService" class="com.dsliusar.services.cache.executor.GenreCacheUpdateService" depends-on="initDb"/>
    <bean id="countryCacheUpdateService" class="com.dsliusar.services.cache.executor.CountryCacheUpdateService" depends-on="initDb"/>
    <bean id="reviewCacheUpdateService" class="com.dsliusar.services.cache.executor.ReviewCacheUpdateService" depends-on="initDb"/>
    <bean id="userCacheUpdateService" class="com.dsliusar.services.cache.executor.UserCacheUpdateService" depends-on="initDb"/>
    <bean id="tokensHousekeepingService" class="com.dsliusar.services.security.executor.TokenHouseKeepingExecutor"/>

    <task:scheduled-tasks scheduler="myScheduler">
        <task:scheduled ref="genreCacheUpdateService" method="updateAllGenresCache" cron="${service.cronGenreCacheUpdateInterval}" />
        <task:scheduled ref="genreCacheUpdateService" method="updateAllGenresWithMovieIdCache" cron="${service.cronGenreMovieCacheUpdateInterval}" />
        <task:scheduled ref="countryCacheUpdateService" method="updateAllCountriesCache" cron="${service.cronAllCountriesUpdateInterval}" />
        <task:scheduled ref="countryCacheUpdateService" method="updateAllMoviesCountriesCache" cron="${service.cronAllMoviesCountriesUpdateInterval}" />
        <task:scheduled ref="reviewCacheUpdateService" method="updateAllMoviesReviewsCache" cron="${service.cronAllReviewsUpdateInterval}" />
        <task:scheduled ref="userCacheUpdateService" method="updateAllUsersReviewsCache" cron="${service.cronAllUsersUpdateInterval}" />
        <task:scheduled ref="tokensHousekeepingService" method="performTokenHousekeeping" cron="${service.cronTokensHouseKeepingInterval}" />
    </task:scheduled-tasks>


</beans>